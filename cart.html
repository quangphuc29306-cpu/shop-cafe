<!DOCTYPE html>
<!--
================================================================================
CART.HTML - Trang Giá» hÃ ng
================================================================================

Chá»©c nÄƒng:
- Hiá»ƒn thá»‹ cÃ¡c sáº£n pháº©m Ä‘Ã£ thÃªm vÃ o giá»
- Cho phÃ©p thay Ä‘á»•i sá»‘ lÆ°á»£ng (+/-)
- XÃ³a sáº£n pháº©m khá»i giá»
- Hiá»ƒn thá»‹ tá»•ng tiá»n
- Link sang trang checkout

YÃªu cáº§u: Pháº£i Ä‘Äƒng nháº­p má»›i cÃ³ giá» hÃ ng

CÃ¡c element quan trá»ng (ID):
- cartItems: Container hiá»ƒn thá»‹ danh sÃ¡ch sáº£n pháº©m
- cartSummary: Box tá»•ng káº¿t Ä‘Æ¡n hÃ ng
- cartTotal: Hiá»ƒn thá»‹ tá»•ng tiá»n
- checkoutBtn: NÃºt thanh toÃ¡n
================================================================================
-->
<html lang="vi">
  <head>
    <!-- ===== META TAGS ===== -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Giá» hÃ ng - Kvone Coffee</title>
    <meta name="description" content="Xem vÃ  quáº£n lÃ½ giá» hÃ ng cá»§a báº¡n" />
    <link rel="icon" type="image/png" href="menu/icons/coffee.png" />

    <!-- View Transitions API -->
    <meta name="view-transition" content="same-origin" />
    <meta name="theme-color" content="#54372b" />

    <!-- ===== CSS ===== -->
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="css/main.css" />
  </head>

  <body>
    <div class="page-wrapper">
      <!-- 
        =====================================================================
        HEADER - TÆ°Æ¡ng tá»± index.html
        Cart button Ä‘Æ°á»£c highlight (Ä‘ang á»Ÿ trang cart)
        =====================================================================
        -->
      <header class="header">
        <div class="header-container">
          <!-- Logo -->
          <a href="index.html" class="logo">
            <span class="logo-icon">â˜•</span>
            <span>Kvone Coffee</span>
          </a>

          <!-- Navigation -->
          <nav class="nav" id="mainNav">
            <a href="index.html" class="nav-link">Menu</a>
            <a href="favorites.html" class="nav-link">YÃªu thÃ­ch</a>
            <a href="orders.html" class="nav-link">ÄÆ¡n hÃ ng</a>
          </nav>

          <!-- Header Actions -->
          <div class="header-actions">
            <!-- 
                    Cart Button - ÄÆ°á»£c highlight vÃ¬ Ä‘ang á»Ÿ trang cart
                    style inline Ä‘á»ƒ Ä‘á»•i mÃ u ná»n
                    -->
            <a
              href="cart.html"
              class="cart-btn"
              style="background: var(--gradient-primary); color: white"
            >
              ğŸ›’
              <span class="cart-badge" style="display: none">0</span>
            </a>

            <!-- User Menu (Ä‘Ã£ Ä‘Äƒng nháº­p) -->
            <div
              class="user-menu"
              id="userMenu"
              style="display: none"
              onclick="toggleUserDropdown()"
            >
              <div class="avatar">U</div>
              <span class="user-name">User</span>
            </div>

            <!-- Auth Links (chÆ°a Ä‘Äƒng nháº­p) -->
            <div id="authLinks" style="display: flex; gap: var(--space-2)">
              <a href="login.html" class="btn btn-ghost btn-sm">ÄÄƒng nháº­p</a>
              <a href="register.html" class="btn btn-secondary btn-sm"
                >ÄÄƒng kÃ½</a
              >
            </div>

            <!-- Mobile Menu Button -->
            <button class="mobile-menu-btn btn btn-ghost" id="mobileMenuBtn" onclick="document.querySelector('.nav').classList.toggle('active')">
              â˜°
            </button>
          </div>
        </div>
      </header>

      <!-- 
        =====================================================================
        MAIN CONTENT - Ná»™i dung chÃ­nh trang giá» hÃ ng
        =====================================================================
        -->
      <main class="main-content">
        <div class="container cart-page">
          <!-- Page Title -->
          <h1 style="margin-bottom: var(--space-6)">ğŸ›’ Giá» hÃ ng cá»§a báº¡n</h1>

          <!-- 
                Grid Layout:
                - Cá»™t trÃ¡i: Danh sÃ¡ch sáº£n pháº©m (cartItems)
                - Cá»™t pháº£i: Tá»•ng káº¿t Ä‘Æ¡n hÃ ng (cartSummary)
                Responsive: 1 cá»™t trÃªn mobile
                -->
          <div
            style="
              display: grid;
              grid-template-columns: 1fr 350px;
              gap: var(--space-6);
              align-items: start;
            "
          >
            <!-- 
                    CART ITEMS - Danh sÃ¡ch sáº£n pháº©m trong giá»
                    Render báº±ng renderCart() tá»« cart.js
                    -->
            <div class="cart-items" id="cartItems">
              <!-- Ná»™i dung Ä‘Æ°á»£c render Ä‘á»™ng báº±ng JavaScript -->
            </div>

            <!-- 
                    CART SUMMARY - Box tá»•ng káº¿t
                    áº¨n máº·c Ä‘á»‹nh, JavaScript sáº½ hiá»‡n khi cÃ³ sáº£n pháº©m
                    -->
            <div class="cart-summary" id="cartSummary" style="display: none">
              <h3 class="cart-summary-title">Tá»•ng Ä‘Æ¡n hÃ ng</h3>

              <!-- Chi tiáº¿t giÃ¡ -->
              <div class="price-breakdown">
                <div class="price-row total">
                  <span>Tá»•ng cá»™ng</span>
                  <!-- ID cartTotal: JavaScript cáº­p nháº­t giÃ¡ trá»‹ -->
                  <span id="cartTotal">0Ä‘</span>
                </div>
              </div>

              <!-- CÃ¡c nÃºt action -->
              <div style="margin-top: var(--space-6)">
                <!-- NÃºt thanh toÃ¡n - Link Ä‘áº¿n checkout.html -->
                <a
                  href="checkout.html"
                  class="btn btn-primary btn-lg w-full"
                  id="checkoutBtn"
                >
                  Thanh toÃ¡n
                </a>
                <!-- NÃºt tiáº¿p tá»¥c mua sáº¯m - Quay láº¡i menu -->
                <a
                  href="index.html"
                  class="btn btn-outline w-full"
                  style="margin-top: var(--space-3)"
                >
                  Tiáº¿p tá»¥c mua sáº¯m
                </a>
              </div>
            </div>
          </div>
        </div>
      </main>

      <!-- 
        =====================================================================
        FOOTER - Giá»‘ng cÃ¡c trang khÃ¡c
        =====================================================================
        -->
      <footer class="footer">
        <div class="footer-container">
          <div class="footer-brand">
            <div class="footer-logo">
              <span>â˜•</span>
              <span>Kvone Coffee</span>
            </div>
            <p class="footer-desc">
              NÆ¡i má»—i ly cÃ  phÃª lÃ  má»™t tÃ¡c pháº©m nghá»‡ thuáº­t, Ä‘Æ°á»£c pha cháº¿ vá»›i
              tÃ¬nh yÃªu vÃ  sá»± táº­n tÃ¢m.
            </p>
          </div>

          <div>
            <h4 class="footer-title">LiÃªn káº¿t</h4>
            <div class="footer-links">
              <a href="index.html" class="footer-link">â˜• Menu</a>
              <a href="favorites.html" class="footer-link">ğŸ’• YÃªu thÃ­ch</a>
              <a href="orders.html" class="footer-link">ğŸ“‹ ÄÆ¡n hÃ ng</a>
            </div>
          </div>

          <div>
            <h4 class="footer-title">LiÃªn há»‡</h4>
            <div class="footer-links">
              <span class="footer-link">ğŸ“ Nguyá»…n VÄƒn Linh, ÄÃ  Náºµng</span>
              <span class="footer-link">ğŸ“ 0905580275</span>
              <span class="footer-link">âœ‰ï¸ kvonecoffee@gmail.com</span>
              <span class="footer-link">â° 7:00 - 22:00 hÃ ng ngÃ y</span>
            </div>
          </div>
        </div>
        <div class="footer-bottom">
          Â© 2024 Kvone Coffee. Made with â¤ï¸ for coffee lovers.
        </div>
      </footer>
    </div>

    <!-- 
    =========================================================================
    USER DROPDOWN MENU - Menu dropdown khi click avatar
    =========================================================================
    -->
    <div
      id="userDropdown"
      class="card"
      style="
        display: none;
        position: fixed;
        top: 70px;
        right: 100px;
        min-width: 220px;
        z-index: 1000;
        box-shadow: var(--shadow-2xl);
      "
    >
      <div class="card-body" style="padding: var(--space-2)">
        <a
          href="orders.html"
          class="btn btn-ghost w-full"
          style="justify-content: flex-start; gap: var(--space-3)"
          >ğŸ“‹ ÄÆ¡n hÃ ng cá»§a tÃ´i</a
        >
        <a
          href="favorites.html"
          class="btn btn-ghost w-full"
          style="justify-content: flex-start; gap: var(--space-3)"
          >â¤ï¸ YÃªu thÃ­ch</a
        >
        <!-- Admin Link - Chá»‰ hiá»‡n cho admin -->
        <a
          href="admin.html"
          id="adminLink"
          class="btn btn-ghost w-full"
          style="
            display: none;
            justify-content: flex-start;
            gap: var(--space-3);
            color: var(--color-primary);
          "
        >
          âš™ï¸ Quáº£n lÃ½ Admin
        </a>
        <div class="divider" style="margin: var(--space-2) 0"></div>
        <button
          class="btn btn-ghost w-full"
          style="
            justify-content: flex-start;
            gap: var(--space-3);
            color: var(--color-error);
          "
          onclick="logout()"
        >
          ğŸšª ÄÄƒng xuáº¥t
        </button>
      </div>
    </div>

    <!-- 
    =========================================================================
    JAVASCRIPT FILES
    =========================================================================
    -->
    <script src="js/storage.js"></script>
    <script src="js/auth.js" ></script>
    <script src="js/products.js"></script>
    <script src="js/sizes.js"></script>
    <script src="js/toppings.js"></script>
    <script src="js/cart.js"></script>
    <script src="js/favorites.js"></script>
    <script src="js/app.js"></script>
    <script src="js/enhancements.js"></script>

    <!-- 
    =========================================================================
    INLINE JAVASCRIPT - Logic riÃªng cho trang cart
    =========================================================================
    -->
    <script>
      // =====================================================================
      // TOGGLE USER DROPDOWN
      // =====================================================================
      function toggleUserDropdown() {
        const dropdown = document.getElementById("userDropdown");
        dropdown.style.display =
          dropdown.style.display === "none" ? "block" : "none";
      }

      // =====================================================================
      // CLICK OUTSIDE TO CLOSE DROPDOWN
      // =====================================================================
      document.addEventListener("click", function (e) {
        const userMenu = document.getElementById("userMenu");
        const dropdown = document.getElementById("userDropdown");

        if (!userMenu?.contains(e.target) && !dropdown?.contains(e.target)) {
          if (dropdown) dropdown.style.display = "none";
        }
      });

      // =====================================================================
      // DOM CONTENT LOADED
      // =====================================================================
      document.addEventListener("DOMContentLoaded", function () {
        // Khá»Ÿi táº¡o app (data, navigation, user info, cart badge)
        initApp();

        // Hiá»ƒn thá»‹ Admin link náº¿u user lÃ  admin
        if (isAdmin()) {
          const adminLink = document.getElementById("adminLink");
          if (adminLink) adminLink.style.display = "flex";
        }

        // Kiá»ƒm tra giá» hÃ ng trá»‘ng TRÆ¯á»šC KHI render
        const cart = getCart();
        const summaryEl = document.getElementById("cartSummary");
        const cartGrid = document.querySelector('.cart-page > div');
        
        if (cart.length === 0) {
          // Giá» trá»‘ng -> áº©n summary ngay láº­p tá»©c vÃ  center empty state
          if (summaryEl) summaryEl.style.display = "none";
          if (cartGrid) cartGrid.style.gridTemplateColumns = "1fr";
        } else {
          // CÃ³ sáº£n pháº©m -> hiá»‡n summary
          if (summaryEl) summaryEl.style.display = "block";
          if (cartGrid) cartGrid.style.gridTemplateColumns = "1fr 350px";
        }

        // Render giá» hÃ ng
        renderCart(document.getElementById("cartItems"));

        // Cáº­p nháº­t tá»•ng tiá»n
        updateCartSummary();
      });

      // =====================================================================
      // CHECK EMPTY CART - áº¨n summary box náº¿u giá» trá»‘ng
      // =====================================================================
      function checkEmptyCart() {
        const cart = getCart();
        const summaryEl = document.getElementById("cartSummary");
        const cartGrid = document.querySelector('.cart-page > div');

        if (cart.length === 0) {
          // Giá» trá»‘ng -> áº©n summary vÃ  center empty state
          if (summaryEl) summaryEl.style.display = "none";
          if (cartGrid) cartGrid.style.gridTemplateColumns = "1fr";
        } else {
          // CÃ³ sáº£n pháº©m -> hiá»‡n summary vÃ  2 cá»™t
          if (summaryEl) summaryEl.style.display = "block";
          if (cartGrid) cartGrid.style.gridTemplateColumns = "1fr 350px";
        }
      }

      // =====================================================================
      // OVERRIDE updateCartSummary
      // ThÃªm check empty cart sau má»—i láº§n update
      // =====================================================================
      const originalUpdateCartSummary = updateCartSummary;
      updateCartSummary = function () {
        // Gá»i hÃ m gá»‘c
        originalUpdateCartSummary();
        // Sau Ä‘Ã³ check empty
        checkEmptyCart();
      };
    </script>

    <!-- 
    =========================================================================
    INLINE CSS - Responsive cho trang cart
    =========================================================================
    -->
    <style>
      /* 
        Responsive: Khi mÃ n hÃ¬nh < 900px
        Chuyá»ƒn tá»« 2 cá»™t sang 1 cá»™t
        */
      @media (max-width: 900px) {
        .cart-page > div {
          grid-template-columns: 1fr !important;
        }

        .cart-summary {
          /* Bá» position sticky trÃªn mobile */
          position: static !important;
        }
      }
      
      /* Center empty cart state */
      .cart-items .empty-state {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 50vh;
        text-align: center;
        padding: var(--space-8);
      }
    </style>
  </body>
</html>
