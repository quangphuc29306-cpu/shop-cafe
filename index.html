<!DOCTYPE html>
<!--
================================================================================
INDEX.HTML - Trang ch·ªß ch√≠nh c·ªßa Website B√°n C√† Ph√™
================================================================================

C·∫•u tr√∫c trang:
1. HEAD: Meta tags, SEO, li√™n k·∫øt CSS
2. HEADER: Logo, navigation, auth buttons, cart
3. HERO: Banner ch√≠nh gi·ªõi thi·ªáu th∆∞∆°ng hi·ªáu
4. PRODUCTS: Danh s√°ch s·∫£n ph·∫©m v·ªõi filter v√† search
5. FEATURES: ƒêi·ªÉm n·ªïi b·∫≠t c·ªßa qu√°n
6. FOOTER: Th√¥ng tin li√™n h·ªá, li√™n k·∫øt
7. SCRIPTS: Load c√°c file JavaScript

C√°c element quan tr·ªçng (ID):
- mainHeader: Header ch√≠nh (sticky)
- productGrid: Container hi·ªÉn th·ªã s·∫£n ph·∫©m
- categoryTabs: Tabs ch·ªçn danh m·ª•c
- searchInput: √î t√¨m ki·∫øm s·∫£n ph·∫©m
- userMenu: Menu user (khi ƒë√£ ƒëƒÉng nh·∫≠p)
- authLinks: N√∫t ƒëƒÉng nh·∫≠p/ƒëƒÉng k√Ω (khi ch∆∞a ƒëƒÉng nh·∫≠p)
- userDropdown: Dropdown menu c·ªßa user
================================================================================
-->
<html lang="vi">
  <!-- lang="vi": Ng√¥n ng·ªØ ti·∫øng Vi·ªát cho SEO v√† accessibility -->

  <head>
    <!-- ===== META TAGS C∆† B·∫¢N ===== -->
    <!-- Charset UTF-8: H·ªó tr·ª£ ti·∫øng Vi·ªát -->
    <meta charset="UTF-8" />

    <!-- Viewport: Responsive tr√™n mobile -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Title: Hi·ªÉn th·ªã tr√™n tab tr√¨nh duy·ªát v√† k·∫øt qu·∫£ t√¨m ki·∫øm -->
    <title>Kvone Coffee - Th∆∞·ªüng th·ª©c c√† ph√™ ch·∫•t l∆∞·ª£ng</title>

    <!-- Description: M√¥ t·∫£ cho SEO (hi·ªÉn th·ªã d∆∞·ªõi title tr√™n Google) -->
    <meta
      name="description"
      content="Kvone Coffee - N∆°i b·∫°n th∆∞·ªüng th·ª©c nh·ªØng ly c√† ph√™ th∆°m ngon nh·∫•t"
    />

    <link rel="icon" type="image/png" href="menu/icons/coffee.png" />

    <!-- View Transitions API - Smooth page transitions -->
    <meta name="view-transition" content="same-origin" />

    <!-- Theme color for mobile browsers -->
    <meta name="theme-color" content="#54372b" />

    <!-- ===== LI√äN K·∫æT CSS ===== -->
    <!-- Google Fonts: Playfair Display (display font) + Inter (body text) -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet" />
    
    <!-- main.css: File CSS t·ªïng h·ª£p, import c√°c file kh√°c -->
    <link rel="stylesheet" href="css/main.css" />
  </head>

  <body>
    <!-- 
    =========================================================================
    PAGE WRAPPER - Bao b·ªçc to√†n b·ªô n·ªôi dung trang
    Gi√∫p layout v√† styling to√†n c·ª•c
    =========================================================================
    -->
    <div class="page-wrapper">
      <!-- 
        =====================================================================
        HEADER - Thanh ƒëi·ªÅu h∆∞·ªõng ch√≠nh
        - Sticky: C·ªë ƒë·ªãnh khi scroll v·ªõi class "scrolled"
        - Ch·ª©a: Logo, Navigation, Cart, User menu
        =====================================================================
        -->
      <header class="header" id="mainHeader">
        <div class="header-container">
          <!-- Logo - Link v·ªÅ trang ch·ªß -->
          <a href="index.html" class="logo">
            <span class="logo-icon">‚òï</span>
            <span>Kvone Coffee</span>
          </a>

          <!-- 
                Navigation ch√≠nh
                - Class "nav" ƒë·ªÉ styling
                - ID ƒë·ªÉ JavaScript toggle menu mobile
                -->
          <nav class="nav" id="mainNav">
            <a href="index.html" class="nav-link active">Menu</a>
            <a href="favorites.html" class="nav-link">Y√™u th√≠ch</a>
            <a href="orders.html" class="nav-link">ƒê∆°n h√†ng</a>
          </nav>

          <!-- C√°c n√∫t action b√™n ph·∫£i header -->
          <div class="header-actions">
            <!-- 
                    Cart Button - Link ƒë·∫øn trang gi·ªè h√†ng
                    Badge hi·ªÉn th·ªã s·ªë l∆∞·ª£ng s·∫£n ph·∫©m trong gi·ªè
                    -->
            <a href="cart.html" class="cart-btn">
              üõí
              <!-- Badge ·∫©n m·∫∑c ƒë·ªãnh, JavaScript s·∫Ω hi·ªÉn th·ªã n·∫øu c√≥ item -->
              <span class="cart-badge" style="display: none">0</span>
            </a>

            <!-- 
                    User Menu - Hi·ªÉn th·ªã khi ƒê√É ƒêƒÇNG NH·∫¨P
                    ƒê∆∞·ª£c renderUserInfo() trong auth.js qu·∫£n l√Ω
                    Click ƒë·ªÉ m·ªü dropdown menu
                    -->
            <div
              class="user-menu"
              id="userMenu"
              style="display: none"
              onclick="toggleUserDropdown()"
            >
              <!-- Avatar: Hi·ªÉn th·ªã ch·ªØ c√°i ƒë·∫ßu t√™n -->
              <div class="avatar">U</div>
              <!-- T√™n user -->
              <span class="user-name">User</span>
            </div>

            <!-- 
                    Auth Links - Hi·ªÉn th·ªã khi CH∆ØA ƒêƒÇNG NH·∫¨P
                    ƒê∆∞·ª£c renderUserInfo() trong auth.js qu·∫£n l√Ω
                    -->
            <div id="authLinks" style="display: flex; gap: var(--space-2)">
              <a href="login.html" class="btn btn-ghost btn-sm">ƒêƒÉng nh·∫≠p</a>
              <a href="register.html" class="btn btn-secondary btn-sm"
                >ƒêƒÉng k√Ω</a
              >
            </div>

            <!-- 
                    Mobile Menu Button - N√∫t hamburger (‚ò∞)
                    Ch·ªâ hi·ªÉn th·ªã tr√™n mobile ƒë·ªÉ toggle navigation
                    -->
            <button class="mobile-menu-btn btn btn-ghost" id="mobileMenuBtn" onclick="document.querySelector('.nav').classList.toggle('active')">
              ‚ò∞
            </button>
          </div>
        </div>
      </header>

      <!-- 
        =====================================================================
        MAIN CONTENT - N·ªôi dung ch√≠nh c·ªßa trang
        =====================================================================
        -->
      <main class="main-content">
        <!-- 
            =================================================================
            HERO SECTION - Banner ch√≠nh
            Gi·ªõi thi·ªáu th∆∞∆°ng hi·ªáu v√† call-to-action
            =================================================================
            -->
        <section class="hero">
          <div class="hero-container">
            <!-- Badge nh·ªè ph√≠a tr√™n title -->
            <span class="hero-badge">‚ú® Ch·∫•t l∆∞·ª£ng h√†ng ƒë·∫ßu</span>

            <!-- Ti√™u ƒë·ªÅ ch√≠nh -->
            <h1 class="hero-title">
              Kh·ªüi ƒë·∫ßu ng√†y m·ªõi v·ªõi<br />
              <span class="hero-title-accent">ly c√† ph√™ ho√†n h·∫£o</span>
            </h1>

            <!-- M√¥ t·∫£ ph·ª• -->
            <p class="hero-subtitle">
              Th∆∞·ªüng th·ª©c h∆∞∆°ng v·ªã c√† ph√™ ƒë·∫≠m ƒë√†, ƒë∆∞·ª£c pha ch·∫ø t·ª´ nh·ªØng h·∫°t c√†
              ph√™ ch·ªçn l·ªçc k·ªπ l∆∞·ª°ng. M·ªói ly l√† m·ªôt tr·∫£i nghi·ªám tuy·ªát v·ªùi.
            </p>

            <!-- C√°c n√∫t CTA (Call-to-Action) -->
            <div class="hero-actions">
              <!-- href="#products" scroll xu·ªëng ph·∫ßn s·∫£n ph·∫©m -->
              <a href="#products" class="btn btn-primary btn-lg">
                ‚òï Xem Menu
              </a>
              <a href="orders.html" class="btn btn-outline btn-lg">
                üìã ƒê∆°n h√†ng c·ªßa t√¥i
              </a>
            </div>
          </div>
        </section>

        <!-- 
            =================================================================
            PRODUCTS SECTION - Danh s√°ch s·∫£n ph·∫©m
            Hi·ªÉn th·ªã c√°c s·∫£n ph·∫©m c√† ph√™ v·ªõi filter v√† search
            =================================================================
            -->
        <section class="section" id="products">
          <div class="container">
            <!-- Header c·ªßa section -->
            <div class="section-header">
              <h2 class="section-title">Menu C√† Ph√™</h2>
              <p class="section-subtitle">
                Kh√°m ph√° b·ªô s∆∞u t·∫≠p c√† ph√™ ƒë·∫∑c bi·ªát, ƒë∆∞·ª£c pha ch·∫ø v·ªõi t√¨nh y√™u
                v√† s·ª± t·∫≠n t√¢m
              </p>
            </div>

            <!-- 
                    Category Tabs - Tabs l·ªçc theo danh m·ª•c
                    Render b·∫±ng JavaScript trong renderCategoryTabs()
                    -->
            <div
              class="category-tabs"
              id="categoryTabs"
              style="margin-bottom: var(--space-6)"
            >
              <!-- N·ªôi dung ƒë∆∞·ª£c render ƒë·ªông b·∫±ng JavaScript -->
            </div>

            <!-- 
                    Search Bar + Price Sort - Thanh t√¨m ki·∫øm v√† s·∫Øp x·∫øp gi√°
                    Layout: Search b√™n tr√°i, Sort b√™n ph·∫£i
                    -->
            <div class="search-sort-container" style="
              display: flex; 
              flex-wrap: wrap;
              gap: var(--space-4); 
              align-items: center; 
              justify-content: center;
              max-width: 700px; 
              margin: 0 auto var(--space-6);
            ">
              <!-- Search Bar -->
              <div class="search-bar" style="flex: 1; min-width: 250px;">
                <span class="search-bar-icon">üîç</span>
                <input
                  type="text"
                  class="form-input"
                  id="searchInput"
                  placeholder="T√¨m ki·∫øm c√† ph√™..."
                  oninput="handleSearch(this.value)"
                />
              </div>

              <!-- Price Sort Dropdown -->
              <div class="price-sort-wrapper" style="display: flex; align-items: center; gap: var(--space-2);">
                <select 
                  id="priceSortSelect" 
                  class="form-input"
                  onchange="handlePriceSort(this.value)"
                  style="
                    padding: var(--space-2) var(--space-4);
                    border-radius: var(--radius-lg);
                    background: var(--color-surface);
                    border: 1px solid var(--color-border);
                    cursor: pointer;
                    font-size: var(--text-sm);
                    min-width: 160px;
                  "
                >
                  <option value="none">S·∫Øp x·∫øp gi√°</option>
                  <option value="low-high">Gi√° th·∫•p ‚Üí cao</option>
                  <option value="high-low">Gi√° cao ‚Üí th·∫•p</option>
                </select>

                <!-- Clear Sort Button - ·∫®n m·∫∑c ƒë·ªãnh -->
                <button 
                  id="clearSortBtn" 
                  class="btn btn-ghost btn-sm"
                  onclick="clearPriceSort()"
                  style="display: none; padding: var(--space-2);"
                  title="X√≥a b·ªô l·ªçc"
                >
                  ‚úï
                </button>
              </div>
            </div>

            <!-- 
                    Product Grid - L∆∞·ªõi hi·ªÉn th·ªã s·∫£n ph·∫©m
                    Render b·∫±ng renderProducts() t·ª´ products.js
                    Grid responsive: 1 c·ªôt mobile, 2-4 c·ªôt desktop
                    -->
            <div class="product-grid" id="productGrid">
              <!-- S·∫£n ph·∫©m ƒë∆∞·ª£c render ƒë·ªông b·∫±ng JavaScript -->
            </div>
          </div>
        </section>

        <!-- 
            =================================================================
            FEATURES SECTION - ƒêi·ªÉm n·ªïi b·∫≠t
            Gi·ªõi thi·ªáu c√°c ∆∞u ƒëi·ªÉm c·ªßa qu√°n
            =================================================================
            -->
        <section class="section" style="background: var(--color-surface)">
          <div class="container">
            <div class="section-header">
              <h2 class="section-title">T·∫°i sao ch·ªçn ch√∫ng t√¥i?</h2>
              <p class="section-subtitle">
                Cam k·∫øt mang ƒë·∫øn tr·∫£i nghi·ªám c√† ph√™ tuy·ªát v·ªùi nh·∫•t
              </p>
            </div>

            <!-- Grid 3 c·ªôt cho features -->
            <div
              style="
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                gap: var(--space-8);
              "
            >
              <!-- Feature 1: H·∫°t c√† ph√™ -->
              <div
                class="card"
                style="text-align: center; padding: var(--space-8)"
              >
                <div style="margin-bottom: var(--space-4)">
                  <img
                    src="menu/icons/coffee.png"
                    alt="H·∫°t c√† ph√™"
                    style="width: 48px; height: 48px; margin: 0 auto"
                  />
                </div>
                <h3
                  style="
                    font-family: var(--font-display);
                    font-size: var(--text-xl);
                    margin-bottom: var(--space-3);
                  "
                >
                  H·∫°t c√† ph√™ ch·ªçn l·ªçc
                </h3>
                <p style="color: var(--color-text-muted)">
                  H·∫°t c√† ph√™ Arabica v√† Robusta cao c·∫•p t·ª´ ƒê√† L·∫°t, Bu√¥n Ma Thu·ªôt
                </p>
              </div>

              <!-- Feature 2: Barista -->
              <div
                class="card"
                style="text-align: center; padding: var(--space-8)"
              >
                <div style="font-size: 48px; margin-bottom: var(--space-4)">
                  üë®‚Äçüç≥
                </div>
                <h3
                  style="
                    font-family: var(--font-display);
                    font-size: var(--text-xl);
                    margin-bottom: var(--space-3);
                  "
                >
                  Barista chuy√™n nghi·ªáp
                </h3>
                <p style="color: var(--color-text-muted)">
                  ƒê·ªôi ng≈© barista ƒë∆∞·ª£c ƒë√†o t·∫°o b√†i b·∫£n, ƒëam m√™ v·ªõi ngh·ªÅ
                </p>
              </div>

              <!-- Feature 3: Giao h√†ng -->
              <div
                class="card"
                style="text-align: center; padding: var(--space-8)"
              >
                <div style="font-size: 48px; margin-bottom: var(--space-4)">
                  ‚ö°
                </div>
                <h3
                  style="
                    font-family: var(--font-display);
                    font-size: var(--text-xl);
                    margin-bottom: var(--space-3);
                  "
                >
                  Giao h√†ng nhanh ch√≥ng
                </h3>
                <p style="color: var(--color-text-muted)">
                  Giao h√†ng trong v√≤ng 30 ph√∫t, ƒë·∫£m b·∫£o c√† ph√™ lu√¥n t∆∞∆°i ngon
                </p>
              </div>
            </div>
          </div>
        </section>
      </main>

      <!-- 
        =====================================================================
        FOOTER - Ch√¢n trang
        Th√¥ng tin li√™n h·ªá, li√™n k·∫øt, b·∫£n quy·ªÅn
        =====================================================================
        -->
      <footer class="footer">
        <div class="footer-container">
          <!-- Brand info -->
          <div class="footer-brand">
            <div class="footer-logo">
              <span>‚òï</span>
              <span>Kvone Coffee</span>
            </div>
            <p class="footer-desc">
              N∆°i m·ªói ly c√† ph√™ l√† m·ªôt t√°c ph·∫©m ngh·ªá thu·∫≠t, ƒë∆∞·ª£c pha ch·∫ø v·ªõi
              t√¨nh y√™u v√† s·ª± t·∫≠n t√¢m. Ch√∫ng t√¥i cam k·∫øt mang ƒë·∫øn tr·∫£i nghi·ªám c√†
              ph√™ tuy·ªát v·ªùi nh·∫•t cho b·∫°n.
            </p>
          </div>

          <!-- Quick links -->
          <div>
            <h4 class="footer-title">Li√™n k·∫øt</h4>
            <div class="footer-links">
              <a href="index.html" class="footer-link">‚òï Menu</a>
              <a href="favorites.html" class="footer-link">üíï Y√™u th√≠ch</a>
              <a href="orders.html" class="footer-link">üìã ƒê∆°n h√†ng</a>
            </div>
          </div>

          <!-- Contact info -->
          <div>
            <h4 class="footer-title">Li√™n h·ªá</h4>
            <div class="footer-links">
              <span class="footer-link">üìç Nguy·ªÖn VƒÉn Linh, ƒê√† N·∫µng</span>
              <span class="footer-link">üìû 0905580275</span>
              <span class="footer-link">‚úâÔ∏è kvonecoffee@gmail.com</span>
              <span class="footer-link">‚è∞ 7:00 - 22:00 h√†ng ng√†y</span>
            </div>
          </div>
        </div>

        <!-- Copyright -->
        <div class="footer-bottom">
          ¬© 2024 Kvone Coffee. Made with ‚ù§Ô∏è for coffee lovers.
        </div>
      </footer>
    </div>

    <!-- 
    =========================================================================
    USER DROPDOWN MENU - Menu dropdown khi click v√†o avatar
    Position: fixed, hi·ªÉn th·ªã d∆∞·ªõi header
    ·∫®n m·∫∑c ƒë·ªãnh, JavaScript toggle visibility
    =========================================================================
    -->
    <div
      id="userDropdown"
      class="card"
      style="
        display: none;
        position: fixed;
        top: 70px;
        right: 100px;
        min-width: 220px;
        z-index: 1000;
        box-shadow: var(--shadow-2xl);
      "
    >
      <div class="card-body" style="padding: var(--space-2)">
        <!-- Link ƒë·∫øn trang ƒë∆°n h√†ng -->
        <a
          href="orders.html"
          class="btn btn-ghost w-full"
          style="justify-content: flex-start; gap: var(--space-3)"
          >üìã ƒê∆°n h√†ng c·ªßa t√¥i</a
        >
        <!-- Link ƒë·∫øn trang y√™u th√≠ch -->
        <a
          href="favorites.html"
          class="btn btn-ghost w-full"
          style="justify-content: flex-start; gap: var(--space-3)"
          >‚ù§Ô∏è Y√™u th√≠ch</a
        >
        <!-- 
            Admin Link - Ch·ªâ hi·ªÉn th·ªã cho admin
            JavaScript ki·ªÉm tra isAdmin() v√† show/hide
            -->
        <a
          href="admin.html"
          id="adminLink"
          class="btn btn-ghost w-full"
          style="
            display: none;
            justify-content: flex-start;
            gap: var(--space-3);
            color: var(--color-primary);
          "
        >
          ‚öôÔ∏è Qu·∫£n l√Ω Admin
        </a>
        <div class="divider" style="margin: var(--space-2) 0"></div>
        <!-- N√∫t ƒëƒÉng xu·∫•t -->
        <button
          class="btn btn-ghost w-full"
          style="
            justify-content: flex-start;
            gap: var(--space-3);
            color: var(--color-error);
          "
          onclick="logout()"
        >
          üö™ ƒêƒÉng xu·∫•t
        </button>
      </div>
    </div>

    <!-- 
    =========================================================================
    JAVASCRIPT FILES - C√°c file JS c·∫ßn load
    TH·ª® T·ª∞ R·∫§T QUAN TR·ªåNG:
    1. storage.js - STORAGE_KEYS v√† c√°c h√†m localStorage (ph·∫£i load ƒë·∫ßu ti√™n)
    2. auth.js - X√°c th·ª±c (ph·ª• thu·ªôc storage.js)
    3. reviews.js - ƒê√°nh gi√° s·∫£n ph·∫©m (ph·ª• thu·ªôc storage.js) - PH·∫¢I TR∆Ø·ªöC products.js
    4. products.js - S·∫£n ph·∫©m (ph·ª• thu·ªôc storage.js, reviews.js)
    5. sizes.js - Sizes (ph·ª• thu·ªôc storage.js)
    6. toppings.js - Toppings (ph·ª• thu·ªôc storage.js)
    7. cart.js - Gi·ªè h√†ng (ph·ª• thu·ªôc products, sizes, toppings)
    8. favorites.js - Y√™u th√≠ch (ph·ª• thu·ªôc products)
    9. categories.js - Danh m·ª•c (ph·ª• thu·ªôc storage.js)
    10. app.js - Kh·ªüi t·∫°o (ph·ª• thu·ªôc t·∫•t c·∫£ file tr√™n)
    =========================================================================
    -->
    <script src="js/storage.js?v=1.1" ></script>
    <script src="js/auth.js?v=1.1" ></script>
    <script src="js/reviews.js?v=1.1" ></script>
    <!-- reviews.js PH·∫¢I tr∆∞·ªõc products.js ƒë·ªÉ renderStars() ho·∫°t ƒë·ªông -->
    <script src="js/products.js?v=1.1" ></script>
    <script src="js/sizes.js?v=1.1" ></script>
    <script src="js/toppings.js?v=1.1" ></script>
    <script src="js/cart.js?v=1.1" ></script>
    <script src="js/favorites.js?v=1.1" ></script>
    <script src="js/categories.js?v=1.1" ></script>
    <script src="js/app.js?v=1.1" ></script>
    <script src="js/enhancements.js?v=1.1" ></script>

    <!-- 
    =========================================================================
    INLINE JAVASCRIPT - Logic ri√™ng cho trang index.html
    =========================================================================
    -->
    <script>
      // =====================================================================
      // BI·∫æN TO√ÄN C·ª§C
      // =====================================================================

      // Danh m·ª•c ƒëang ƒë∆∞·ª£c ch·ªçn ƒë·ªÉ filter
      // 'all' = T·∫•t c·∫£ s·∫£n ph·∫©m
      // Ho·∫∑c ID danh m·ª•c c·ª• th·ªÉ (v√≠ d·ª•: 'cat1')
      let currentCategory = "all";

      // S·∫Øp x·∫øp gi√° hi·ªán t·∫°i
      // 'none' = Kh√¥ng s·∫Øp x·∫øp (m·∫∑c ƒë·ªãnh)
      // 'low-high' = Gi√° th·∫•p ƒë·∫øn cao
      // 'high-low' = Gi√° cao ƒë·∫øn th·∫•p
      let currentPriceSort = "none";

      // =====================================================================
      // KH·ªûI T·∫†O TRANG - Ch·∫°y khi DOM ready
      // C·∫¨P NH·∫¨T: Th√™m hi·ªáu ·ª©ng Skeleton Loading
      // =====================================================================
      document.addEventListener("DOMContentLoaded", function () {
        // G·ªçi initApp() t·ª´ app.js
        initApp();

        // Render c√°c tab danh m·ª•c
        renderCategoryTabs();

        const productGrid = document.getElementById("productGrid");

        // 1. Hi·ªÉn th·ªã Skeleton loading tr∆∞·ªõc
        renderSkeletons(productGrid, 8); // Hi·ªÉn th·ªã 8 khung x∆∞∆°ng gi·∫£ l·∫≠p

        // 2. Gi·∫£ l·∫≠p delay (ƒë·ªÉ ng∆∞·ªùi d√πng k·ªãp nh√¨n th·∫•y hi·ªáu ·ª©ng loading ƒë·∫πp m·∫Øt)
        // Trong th·ª±c t·∫ø s·∫Ω l√† await fetch API...
        setTimeout(() => {
          // 3. Render s·∫£n ph·∫©m th·∫≠t sau khi "t·∫£i xong"
          // G·ªçi filterByCategory('all') thay v√¨ renderProducts tr·ª±c ti·∫øp
          // ƒë·ªÉ √°p d·ª•ng logic ·∫©n s·∫£n ph·∫©m thu·ªôc danh m·ª•c ƒë√£ t·∫Øt
          filterByCategory('all');
        }, 500); // Delay 0.5 gi√¢y

        // Hi·ªÉn th·ªã Admin link n·∫øu user l√† admin
        if (isAdmin()) {
          const adminLink = document.getElementById("adminLink");
          if (adminLink) {
            adminLink.style.display = "flex";
          }
        }

        // Header scroll effect is handled by enhancements.js HeaderGlass
      });

      // =====================================================================
      // RENDER CATEGORY TABS - V·∫Ω c√°c tab danh m·ª•c
      // =====================================================================
      function renderCategoryTabs() {
        const container = document.getElementById("categoryTabs");

        // getCategories(true) - Ch·ªâ l·∫•y danh m·ª•c c√≥ active = true
        const categories = getCategories(true);

        container.innerHTML = `
                <!-- Tab "T·∫•t c·∫£" lu√¥n c√≥ -->
                <button class="category-tab ${
                  currentCategory === "all" ? "active" : ""
                }" 
                        onclick="filterByCategory('all')">
                    üçµ T·∫•t c·∫£
                </button>
                
                <!-- Render c√°c tab danh m·ª•c t·ª´ database -->
                ${categories
                  .map(
                    (cat) => `
                    <button class="category-tab ${
                      currentCategory === cat.id ? "active" : ""
                    }" 
                            onclick="filterByCategory('${cat.id}')">
                        ${renderCategoryIcon(cat.icon, 20)} ${cat.name}
                    </button>
                `
                  )
                  .join("")}
            `;
      }

      // =====================================================================
      // FILTER BY CATEGORY - L·ªçc s·∫£n ph·∫©m theo danh m·ª•c
      // =====================================================================
      function filterByCategory(categoryId) {
        // L∆∞u danh m·ª•c ƒë∆∞·ª£c ch·ªçn
        currentCategory = categoryId;

        // Re-render tabs ƒë·ªÉ c·∫≠p nh·∫≠t class "active"
        renderCategoryTabs();

        const productGrid = document.getElementById("productGrid");
        
        // ========== L·∫§Y DANH S√ÅCH ID DANH M·ª§C ƒêANG ACTIVE ==========
        /**
         * Khi admin t·∫Øt danh m·ª•c ‚Üí ·∫®n lu√¥n T·∫§T C·∫¢ s·∫£n ph·∫©m thu·ªôc danh m·ª•c ƒë√≥
         * 
         * Logic:
         * - L·∫•y danh s√°ch ID c√°c danh m·ª•c ƒëang active
         * - Filter s·∫£n ph·∫©m: ch·ªâ gi·ªØ l·∫°i s·∫£n ph·∫©m c√≥ categoryId active
         *   HO·∫∂C kh√¥ng c√≥ categoryId (s·∫£n ph·∫©m ch∆∞a ph√¢n lo·∫°i)
         */
        const activeCategories = getCategories(true);
        const activeCategoryIds = activeCategories.map(cat => cat.id);
        
        let products;

        if (categoryId === "all") {
          // L·∫•y t·∫•t c·∫£ s·∫£n ph·∫©m NH∆ØNG ch·ªâ nh·ªØng s·∫£n ph·∫©m thu·ªôc danh m·ª•c ƒëang active
          products = getProducts().filter(p => {
            if (!p.categoryId) return true; // S·∫£n ph·∫©m kh√¥ng c√≥ danh m·ª•c ‚Üí hi·ªÉn th·ªã
            return activeCategoryIds.includes(p.categoryId);
          });
        } else {
          // L·ªçc theo categoryId ƒë∆∞·ª£c ch·ªçn
          products = getProducts().filter((p) => p.categoryId === categoryId);
        }

        // √Åp d·ª•ng s·∫Øp x·∫øp gi√° (n·∫øu c√≥)
        products = applySortToProducts(products);

        // Render l·∫°i danh s√°ch s·∫£n ph·∫©m
        renderProducts(productGrid, products);
      }

      // =====================================================================
      // HANDLE SEARCH - X·ª≠ l√Ω t√¨m ki·∫øm
      // S·ª≠ d·ª•ng debounce ƒë·ªÉ tr√°nh g·ªçi qu√° nhi·ªÅu l·∫ßn
      // =====================================================================
      const handleSearch = debounce(function (query) {
        const productGrid = document.getElementById("productGrid");

        // T√¨m ki·∫øm theo query
        let products = searchProducts(query);
        
        // ========== ·∫®N S·∫¢N PH·∫®M THU·ªòC DANH M·ª§C ƒê√É T·∫ÆT ==========
        /**
         * Khi search c≈©ng c·∫ßn filter theo danh m·ª•c active
         * S·∫£n ph·∫©m thu·ªôc danh m·ª•c ƒë√£ t·∫Øt s·∫Ω kh√¥ng hi·ªán trong k·∫øt qu·∫£ t√¨m ki·∫øm
         */
        const activeCategories = getCategories(true);
        const activeCategoryIds = activeCategories.map(cat => cat.id);
        
        products = products.filter(p => {
          if (!p.categoryId) return true;
          return activeCategoryIds.includes(p.categoryId);
        });

        // K·∫øt h·ª£p v·ªõi filter danh m·ª•c hi·ªán t·∫°i
        if (currentCategory !== "all") {
          products = products.filter((p) => p.categoryId === currentCategory);
        }

        // √Åp d·ª•ng s·∫Øp x·∫øp gi√° (n·∫øu c√≥)
        products = applySortToProducts(products);

        // Render k·∫øt qu·∫£
        renderProducts(productGrid, products);
      }, 300); // 300ms delay

      // =====================================================================
      // USER DROPDOWN - Toggle menu dropdown c·ªßa user
      // =====================================================================
      function toggleUserDropdown() {
        const dropdown = document.getElementById("userDropdown");
        // Toggle visibility
        dropdown.style.display =
          dropdown.style.display === "none" ? "block" : "none";
      }

      // =====================================================================
      // CLICK OUTSIDE TO CLOSE - ƒê√≥ng dropdown khi click b√™n ngo√†i
      // =====================================================================
      document.addEventListener("click", function (e) {
        const userMenu = document.getElementById("userMenu");
        const dropdown = document.getElementById("userDropdown");

        // Ki·ªÉm tra click c√≥ ph·∫£i b√™n ngo√†i userMenu v√† dropdown kh√¥ng
        // Optional chaining (?.) ƒë·ªÉ tr√°nh l·ªói n·∫øu element null
        if (!userMenu?.contains(e.target) && !dropdown?.contains(e.target)) {
          // ·∫®n dropdown
          if (dropdown) dropdown.style.display = "none";
        }
      });

      // =====================================================================
      // PRICE SORT - S·∫Øp x·∫øp s·∫£n ph·∫©m theo gi√°
      // =====================================================================
      
      /**
       * X·ª≠ l√Ω khi thay ƒë·ªïi dropdown s·∫Øp x·∫øp gi√°
       * 
       * @param {string} sortType - 'none', 'low-high', 'high-low'
       */
      function handlePriceSort(sortType) {
        currentPriceSort = sortType;
        
        // C·∫≠p nh·∫≠t UI (n√∫t x√≥a, tr·∫°ng th√°i)
        updateSortUI();
        
        // √Åp d·ª•ng l·∫°i t·∫•t c·∫£ filters v·ªõi sort m·ªõi
        applyAllFilters();
        
        // Scroll v·ªÅ ƒë·∫ßu danh s√°ch s·∫£n ph·∫©m
        scrollToProducts();
      }
      
      /**
       * X√≥a b·ªô l·ªçc gi√° - reset v·ªÅ m·∫∑c ƒë·ªãnh
       */
      function clearPriceSort() {
        currentPriceSort = "none";
        
        // Reset dropdown v·ªÅ m·∫∑c ƒë·ªãnh
        const select = document.getElementById("priceSortSelect");
        if (select) select.value = "none";
        
        // C·∫≠p nh·∫≠t UI
        updateSortUI();
        
        // √Åp d·ª•ng l·∫°i filters
        applyAllFilters();
      }
      
      /**
       * C·∫≠p nh·∫≠t giao di·ªán li√™n quan ƒë·∫øn sort
       * - Hi·ªán/·∫©n n√∫t x√≥a b·ªô l·ªçc (X) b√™n c·∫°nh dropdown
       */
      function updateSortUI() {
        const clearBtn = document.getElementById("clearSortBtn");
        
        if (currentPriceSort === "none") {
          // ·∫®n n√∫t x√≥a
          if (clearBtn) clearBtn.style.display = "none";
        } else {
          // Hi·ªán n√∫t x√≥a
          if (clearBtn) clearBtn.style.display = "flex";
        }
      }
      
      /**
       * S·∫Øp x·∫øp m·∫£ng s·∫£n ph·∫©m theo gi√°
       * 
       * @param {Array} products - M·∫£ng s·∫£n ph·∫©m c·∫ßn s·∫Øp x·∫øp
       * @returns {Array} M·∫£ng ƒë√£ ƒë∆∞·ª£c s·∫Øp x·∫øp
       */
      function applySortToProducts(products) {
        if (currentPriceSort === "none") return products;
        
        // T·∫°o b·∫£n sao ƒë·ªÉ kh√¥ng thay ƒë·ªïi m·∫£ng g·ªëc
        const sorted = [...products];
        
        if (currentPriceSort === "low-high") {
          sorted.sort((a, b) => a.price - b.price);
        } else if (currentPriceSort === "high-low") {
          sorted.sort((a, b) => b.price - a.price);
        }
        
        return sorted;
      }
      
      /**
       * Scroll m∆∞·ª£t v·ªÅ ƒë·∫ßu danh s√°ch s·∫£n ph·∫©m
       */
      function scrollToProducts() {
        const productSection = document.getElementById("products");
        if (productSection) {
          productSection.scrollIntoView({ behavior: "smooth", block: "start" });
        }
      }
      
      /**
       * √Åp d·ª•ng t·∫•t c·∫£ filters (category, search, price sort)
       * H√†m t·ªïng h·ª£p ƒë·ªÉ tr√°nh duplicate code
       */
      function applyAllFilters() {
        const productGrid = document.getElementById("productGrid");
        const searchInput = document.getElementById("searchInput");
        const query = searchInput ? searchInput.value.trim() : "";
        
        // 1. L·∫•y s·∫£n ph·∫©m theo danh m·ª•c active
        const activeCategories = getCategories(true);
        const activeCategoryIds = activeCategories.map(cat => cat.id);
        
        let products;
        
        if (query) {
          // C√≥ search query ‚Üí d√πng search
          products = searchProducts(query);
        } else {
          // Kh√¥ng c√≥ query ‚Üí l·∫•y t·∫•t c·∫£
          products = getProducts();
        }
        
        // 2. Filter theo danh m·ª•c active
        products = products.filter(p => {
          if (!p.categoryId) return true;
          return activeCategoryIds.includes(p.categoryId);
        });
        
        // 3. Filter theo category tab hi·ªán t·∫°i
        if (currentCategory !== "all") {
          products = products.filter(p => p.categoryId === currentCategory);
        }
        
        // 4. √Åp d·ª•ng s·∫Øp x·∫øp gi√°
        products = applySortToProducts(products);
        
        // 5. Render k·∫øt qu·∫£
        renderProducts(productGrid, products);
      }
    </script>
  </body>
</html>
